<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Z-BLOG</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-siteapp"/>
  <link rel="icon" type="image/png" th:href="@{${basePath}+'stage/assets/i/favicon.jpg'}" href="stage/assets/i/favicon.jpg">
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" sizes="192x192"  th:href="@{${basePath}+'stage/assets/i/favicon.jpg'}" href="stage/assets/i/favicon.jpg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
  <link rel="apple-touch-icon-precomposed" th:href="@{${basePath}+'stage/assets/i/favicon.jpg'}" href="stage/assets/i/favicon.jpg">
  <meta name="msapplication-TileImage" th:href="@{${basePath}+'stage/assets/i/favicon.jpg'}" content="stage/assets/i/favicon.jpg">
  <meta name="msapplication-TileColor" content="#0e90d2">
  <link rel="stylesheet" th:href="@{${basePath}+'stage/assets/css/amazeui.min.css'}" href="stage/assets/css/amazeui.min.css">
  <link rel="stylesheet" th:href="@{${basePath}+'stage/assets/css/app.css'}" href="stage/assets/css/app.css">
  <link rel="stylesheet" th:href="@{${basePath}+'plug-in/bootstrap3.3.7/fonts/glyphicons-halflings-regular.woff'}" href="plug-in/bootstrap3.3.7/fonts/glyphicons-halflings-regular.woff" />
  <link rel="stylesheet" th:href="@{${basePath}+'plug-in/bootstrap3.3.7/css/bootstrap.min.css'}" href="plug-in/bootstrap3.3.7/css/bootstrap.min.css" />
<!--   <link rel="stylesheet" href="plug-in/bootstrap3.3.7/css/bootstrap-theme.min.css" /> -->
  <link rel="stylesheet" th:href="@{${basePath}+'plug-in/bootstrap3.3.7/buttons.css'}" href="plug-in/bootstrap3.3.7/buttons.css">
  <link rel="stylesheet" th:href="@{${basePath}+'moudle/admin.css'}" href="moudle/admin.css">
  
</head>
<body id="blog" style="height: 100%; color: rgb(0, 0, 0); ">
<!-- <header class="am-g am-g-fixed blog-fixed blog-text-center blog-header">
	
    <div class="am-u-sm-8 am-u-sm-centered">
        <img width="200" src="https://www.aroad.xyz/source/img/favicon.png" alt="Amaze UI Logo"/>
        <h2 class="am-hide-sm-only">我似江潮来又去，君如鸥鹭逐波还</h2>
    </div>
</header>
<hr> -->
<!-- <div th:include="common/admin :: daoTop"></div> -->
<!-- <hr> -->
<div class="am-g am-g-fixed blog-fixed blog-content">
		<div class="container">
			张小菜个人博客
		</div>
		<div class="container">
			<div class="panel panel-default  panel-info " style="margin-top: 5px">
				<div class="panel-heading ">
					<h5 class="panel-title">找回密码
					</h5>
				</div>
				<div class="panel-body">
					<div class="row col-sm-12 modal-body" style="padding-top: 15px">
						<form id="pass" class="form-horizontal" onsubmit="return false">
							<input type="hidden" name="id" class="form-control" id="input_tagId">
							<div class="form-group  first">
								<label for="inputpageHerf" class="col-sm-3 control-label">选择你设置的密保问题</label>
								<div class="col-sm-6">
									<select class="form-control" id="input_selName">
										<option value="0" selected="selected">-------选择密保问题------ </option>
										<option value="1">读书时你的朋友叫你什么？ </option>
										<option value="2">读书时印象深刻老师叫什么？ </option>
										<option value="3">2011年你做错了什么事？ </option>
										<option value="3">2014年你记错了哪一年？ </option>
										<option value="4">读书时班级人数最多的时候是多少人？ </option>
										<option value="5">你最喜欢的明星叫什么？ </option>
										<option value="6">你最喜欢的颜色是什么？ </option>
										<option value="7">你最喜欢的零食是什么？ </option>
										<option value="8">你最喜欢的生活是什么样子？ </option>
										<option value="9">你最喜欢的零食叫什么？ </option>
										<option value="10">你最崇拜的古人叫什么？ </option>
									</select>
								</div>
							</div>
							
							<div class="form-group  first">
									<label for="inputpageNo" class="col-sm-3 control-label">密保答案</label>
									<div class="col-sm-6">
										<input type="password" name="tagCode" class="form-control" id="input_answerCode" placeholder="标签代码" data-toggle="tooltip" title="新密码"> <span id="pageNo_block" class="help-block"></span>
									</div>
							</div>
							<div class="form-group  first">
									<label for="inputpageNo" class="col-sm-3 control-label">密保证书ID</label>
									<div class="col-sm-6">
										<input type="password" name="mobileCode" class="form-control" id="input_mobileCode" > <span id="pageNo_block" class="help-block"></span>
									</div>
							</div>
							
							<div class="form-group  first">
									<label for="inputpageNo" class="col-sm-3 control-label">人机验证</label>
									<div class="col-sm-3">
										<input type="text" name="tagCode" class="form-control" id="input_verifyCode" placeholder="标签代码" data-toggle="tooltip" title="新密码"> <span id="pageNo_block" class="help-block"></span>
									</div>
									<div class="col-sm-3">
										<a href="javascript:void(0);" rel="external nofollow" title="点击更换验证码">
   										<img id="imgVerify" src="getVerify" alt="更换验证码" height="36" width="100%" onclick="getVerify(this);">
  										</a>
									</div>
							</div>
							<div class="form-group first">
								<label for="inputlinkTag" class="col-sm-3 control-label">&nbsp;</label>
								<div class="col-sm-6">
							    	<button type="button" class="btn btn-primary" id="pass_check_btn">提交身份验证</button>&nbsp;&nbsp;
							    	<button type="button" class="btn btn-primary adminbtn" >返回登录页面</button>
							  </div>
						   </div>
						   
							<div class="form-group  second">
									<label for="inputpageNo" class="col-sm-3 control-label">改密密码</label>
									<div class="col-sm-6">
										<input type="password" name="secCode" class="form-control" id="input_changepass" placeholder="身份密码" data-toggle="tooltip" title="身份密码"> <span id="pageNo_block" class="help-block"></span>
									</div>
							</div>
							<div class="form-group  second">
									<label for="inputpageNo" class="col-sm-3 control-label">新密码</label>
									<div class="col-sm-6">
										<input type="password" name="newpass" class="form-control" id="input_newpassCode" placeholder="新密码" data-toggle="tooltip" title="新密码"> <span id="pageNo_block" class="help-block"></span>
									</div>
							</div>
							<div class="form-group  second">
								<label for="inputlinkTag" class="col-sm-3 control-label">确认新密码</label>
								<div class="col-sm-6">
									<input type="password" name="repass" class="form-control" id="input_repassCode" placeholder="确认新密码" data-toggle="tooltip" title="确认新密码" value="" onkeyup="checkpass()"> <span id="linkTag_block" class="help-block"></span>
								</div>
						   </div>
						   <div class="form-group second">
								<label for="inputlinkTag" class="col-sm-3 control-label">&nbsp;</label>
								<div class="col-sm-6">
							    	<button type="button" class="btn btn-primary" id="pass_save_btn">确认修改密码</button>&nbsp;&nbsp;
							    	<button type="button" class="btn btn-primary adminbtn" >返回登录页面</button>
							  </div>
						   </div>
						    
						</form>
								 
					 </div>
				</div>
			</div>
		</div>
	</div>
<!-- content end-->
        

<footer class="blog-footer">
     <div th:include="common/admin-footer :: adminFoot"></div>
</footer>
<script th:src="@{${basePath}+'plug-in/fileinput/js/jquery-2.0.3.min.js'}" src="plug-in/fileinput/js/jquery-2.0.3.min.js"></script> 
<script th:src="@{${basePath}+'stage/assets/js/amazeui.min.js'}"></script> 
<script th:src="@{${basePath}+'plug-in/bootstrap3.3.7/js/bootstrap.min.js'}" src="plug-in/bootstrap3.3.7/js/bootstrap.min.js" type="text/javascript"></script> 
<script th:src="@{${basePath}+'moudle/js/form.js'}" src="moudle/js/form.js" type="text/javascript"></script>
<script th:inline="javascript">
</script>

<script type="text/javascript">
	$(function(){
		//initData();
		$(".second").hide();
	});
	
	$(document).on("click","#pass_check_btn", function(){
		var qs = $("#input_selName").val();
		var an = $("#input_answerCode").val();
		var code = $("#input_verifyCode").val();
		var mob = $("#input_mobileCode").val();
		
		var url = "checkquestion";
		var data = JSON.stringify({'qs':qs, 'an':an, 'code':code,'mobile':mob});
		//console.log(data);
		requestHandle(url,data);
	});

	//验证操作
	function requestHandle(url,data){
		$.ajax({
			url: url,
			data: data ,//JSON.stringify(data),
			type:"post",
			dataType :"json",
			contentType: "application/json;charset=UTF-8",
			cache : false,
			success:function(result){
				console.log(result);
				if(result.success){
					AlertModal("success",result.msg);
					$(".first").hide();
					$(".second").show();
					
				}else{
					AlertModal("error",result.msg);
				}
			},
			error:function(responseText,status,error){
				console.log(status);
				console.log(responseText);
				console.log(error);
				alert("请求或处理出错！");
			}
		});
	}
	
	$("#input_changepass").keyup(function(){
		var secpass = $("#input_changepass").val();
		console.log(secpass);
		if(secpass.length>6){
			checkSecpass(secpass);
		}
	});
	function checkSecpass(secpass){
		$.ajax({
			url: "checkSecpass",
			data: JSON.stringify({'secpass':secpass}),
			type:"post",
			dataType :"json",
			contentType: "application/json;charset=UTF-8",
			cache : false,
			success:function(result){
				console.log(result);
				if(result.success){
					//AlertModal("success",result.msg);
					$("#input_changepass").parent().removeClass("has-error");
					$("#input_changepass").parent().addClass("has-success");
				}else{
					//AlertModal("error",result.msg);
					$("#input_changepass").parent().removeClass("has-success");
					$("#input_changepass").parent().addClass("has-error");
				}
			},
			error:function(responseText,status,error){
				console.log(status);
				console.log(responseText);
				console.log(error);
				alert("请求或处理出错！");
			}
		});
	}
	
	//修改密码
	$(document).on("click","#pass_save_btn", function(){
		
		var url = "resetPwd";
		var newpass = $("#input_newpassCode").val(); 
		//console.log(data);
		var data = JSON.stringify({'newpass':newpass });
		changeHandle(url,data);
	});
	
	function changeHandle(url,data){
		$.ajax({
			url: url,
			data: data ,//JSON.stringify(data),
			type:"post",
			dataType :"json",
			contentType: "application/json;charset=UTF-8",
			cache : false,
			success:function(result){
				console.log(result);
				if(result.success){
					AlertModal("success",result.msg);
					window.location.href = "admin";					
				}else{
					AlertModal("error",result.msg);
				}
			},
			error:function(responseText,status,error){
				console.log(status);
				console.log(responseText);
				console.log(error);
				alert("请求或处理出错！");
			}
		});
	}
	//获取验证码
	function getVerify(obj){
	 	obj.src = "getVerify?"+Math.random();
	}
	
	function checkpass(){
		var newpass = $("#input_newpassCode").val(); 
		var repass = $("#input_repassCode").val(); 
		if(newpass==repass){
			$("#input_repassCode").parent().removeClass("has-error");
			$("#input_repassCode").parent().addClass("has-success");
			$("#pass_save_btn").removeClass("disabled");
		}else{
			$("#input_repassCode").parent().removeClass("has-success");
			$("#input_repassCode").parent().addClass("has-error");
			$("#pass_save_btn").addClass("disabled");
		}
	}
	$(document).on("click",".adminbtn", function(){
		window.location.href = "admin";	
	});

</script>
<div th:include="common/message :: msg"></div> 
</body>	
</html>